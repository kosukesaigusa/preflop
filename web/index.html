<!DOCTYPE html>
<html lang="ja">
<head>
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="robots" content="noindex, nofollow">
  <meta name="description" content="ポーカーのプリフロップハンドレンジを学習するためのアプリケーションです。">
  <meta name="keywords" content="ポーカー,プリフロップ,ハンドレンジ,学習,トレーニング">
  <meta name="author" content="kosukesaigusa">
  <meta name="theme-color" content="#1A1A2E">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Preflop Trainer">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Preflop Trainer">
  <meta property="og:description" content="ポーカーのプリフロップハンドレンジを学習するためのアプリケーションです。">
  <meta property="og:image" content="icons/Icon-192.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="Preflop Trainer">
  <meta property="twitter:description" content="ポーカーのプリフロップハンドレンジを学習するためのアプリケーションです。">
  <meta property="twitter:image" content="icons/Icon-192.png">

  <title>Preflop Trainer - ポーカーのプリフロップハンドレンジ学習アプリ</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .loading-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      width: 100vw;
      background-color: #1A1A2E;
    }
    .loading-icon {
      width: 120px;
      height: 120px;
      animation: rotate 4s cubic-bezier(0.68, -0.55, 0.265, 1.55) infinite;
      filter: drop-shadow(0 0 12px rgba(229, 185, 78, 0.4));
    }
    @keyframes rotate {
      0% {
        transform: rotate(0deg);
      }
      25% {
        transform: rotate(90deg);
      }
      50% {
        transform: rotate(180deg);
      }
      75% {
        transform: rotate(270deg);
      }
      85% {
        transform: rotate(405deg);
      }
      95% {
        transform: rotate(315deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body>
  <div id="loading" class="loading-container">
    <img src="icons/Icon-512.png" class="loading-icon" alt="Loading..." />
  </div>
  <script>
    // Flutter の初期化が完了したかどうか。
    let isFlutterInitialized = false;

    // ローディング画面を非表示にする関数。
    function hideLoading() {
      const loading = document.querySelector('#loading');
      if (loading) {
        loading.remove();
      }
    }

    // エラー時の処理。
    function handleError(error) {
      console.error('Flutter の初期化中にエラーが発生しました:', error);
      hideLoading();
    }

    function initFlutter() {
      // 既に初期化済みの場合は処理を終了する。
      if (isFlutterInitialized) {
        return;
      }

      // タイムアウト処理を設定する（5秒）。
      const timeoutId = setTimeout(() => {
        hideLoading();
      }, 5000);

      // flutter_bootstrap.js の読み込みが完了していない場合は、
      // 100ms 後に再度初期化を試みる。
      // _flutter オブジェクトは flutter_bootstrap.js によって
      // グローバルスコープに定義される。
      if (typeof _flutter === 'undefined') {
        setTimeout(initFlutter, 100);
        return;
      }

      // Flutter の初期化が完了したことを記録する。
      isFlutterInitialized = true;

      // Flutter アプリケーションを初期化する。
      _flutter.loader.load({
        onEntrypointLoaded: async function(engineInitializer) {
          try {
            // Flutter エンジンを初期化し、アプリケーションを実行する。
            const appRunner = await engineInitializer.initializeEngine();
            await appRunner.runApp();
          } catch (error) {
            handleError(error);
          } finally {
            // タイムアウトをクリアする。
            clearTimeout(timeoutId);
            // ローディング画面を非表示にする。
            hideLoading();
          }
        }
      }).catch(handleError);
    }

    // ページ読み込み完了から一定時間経過後も Flutter が初期化されない場合にフォールバックする。
    window.addEventListener('load', () => {
      setTimeout(() => {
        if (!isFlutterInitialized) {
          hideLoading();
        }
      }, 8000);
    });
  </script>
  <script src="flutter_bootstrap.js" onload="initFlutter()"></script>
</body>
</html>
